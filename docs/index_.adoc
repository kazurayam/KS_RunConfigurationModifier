= A utility class that modifies the RunConfiguration in Katalon Studio project

== Problem to solve

All Katalon Studio users should be familiar with the "Project Setting > Excecution" dialog of the Katalon Studio GUI as follows:

image:https://kazurayam.github.io/KS_RunConfigurationModifier/images/ProjectSettings_Execution.png[]

Let's look at the `Default wait for element timeout (in seconds)`. Of course, you can change the value during the authoring time before you run your Test Cases. Now I want to update the timeout value programatically runtime. Is it possbile?

Katalon API includes a class `com.kms.katalon.core.configuration.RunConfiguration` which implements a method `int getTimeOut()`

- https://api-docs.katalon.com/com/kms/katalon/core/configuration/RunConfiguration.html#getTimeOut()[]

The value of `Default wait for element timeout (in seconds)` configured in the Katalon Studio GUI is made accessible as the return of `int getTimeOut()` method.

Howerver, `RunConfiguration` class has no `setTimeOut(int)` method. Therefore it seems that Katalon does not support a capability to update the timeout value by user codes. --- But I want to know how to hack it.

== Solution

You can read the source code of `com.kms.katalon.core.configuration.RunConfiguration` class. The source code is distributed bundled in the Katalon Studio. You can find it in the `<Katalon Studio installation folder>/Contents/Eclipse/configuration/resources/source/com.kms.katalon.core/com.kms.katalon.core-sources.jar`.

By a deep study in the source code, I found a way of hacking. See the following solution described.

== Description

=== Adding a method into RunConfiguration class that pretty-prints the Execution Setting

[source,groovy]
----
include::../Scripts/prettyPrintExecutionSetting/Script1737627411806.groovy[]
----

When I ran this, I got the following output in the console:

[source,text]
----
1月 23, 2025 8:50:59 午後 com.kms.katalon.core.logging.KeywordLogger startTest
情報: --------------------
1月 23, 2025 8:50:59 午後 com.kms.katalon.core.logging.KeywordLogger startTest
情報: START Test Cases/prettyPrintExecutionSetting
localExecutionSettingMapStorage:
{
  "runningMode" : "GUI",
  "allowCustomizeRequestResponseSizeLimit" : false,
  "source" : "/Users/kazurayam/katalon-workspace/KS_RunConfigurationModifier/Test Cases/prettyPrintExecutionSetting.tc",
  "katalon.versionNumber" : "10.0.1",
  "Name" : "Chrome",
  "host" : {
    "hostName" : "kazurayam - localhost",
    "os" : "Mac OS X 64bit",
    "hostPort" : 54160.0,
    "hostAddress" : "127.0.0.1"
  },
  "katalon.buildNumber" : "223",
  "id" : "Test Cases/prettyPrintExecutionSetting",
  "allowCustomizeRequestTimeout" : false,
  "executedEntity" : "TestCase",
  "projectDir" : "/Users/kazurayam/katalon-workspace/KS_RunConfigurationModifier",
  "isDebugLaunchMode" : false,
  "logbackConfigFileLocation" : "/Applications/Katalon Studio.app/Contents/Eclipse/configuration/org.eclipse.osgi/86/0/.cp/resources/logback/logback-console.xml",
  "name" : "prettyPrintExecutionSetting",
  "allowUsingSelfHealing" : false,
  "allowUsingTimeCapsule" : true,
  "pluginTestListeners" : [ "KatalonReportListener" ],
  "sessionServer.host" : "localhost",
  "description" : "",
  "testops" : { },
  "execution" : {
    "general" : {
      "autoApplyNeighborXpaths" : false,
      "ignorePageLoadTimeoutException" : false,
      "timeCapsuleEnabled" : false,
      "executionProfile" : "default",
      "excludeKeywords" : [ "verifyElementPresent", "verifyElementNotPresent" ],
      "xpathsPriority" : [ {
        "left" : "xpath:attributes",
        "right" : true
      }, {
        "left" : "xpath:idRelative",
        "right" : true
      }, {
        "left" : "dom:name",
        "right" : true
      }, {
        "left" : "xpath:link",
        "right" : true
      }, {
        "left" : "xpath:neighbor",
        "right" : true
      }, {
        "left" : "xpath:href",
        "right" : true
      }, {
        "left" : "xpath:img",
        "right" : true
      }, {
        "left" : "xpath:position",
        "right" : true
      }, {
        "left" : "xpath:customAttributes",
        "right" : true
      } ],
      "timeout" : 30.0,
      "actionDelay" : 0.0,
      "methodsPriorityOrder" : [ {
        "left" : "XPATH",
        "right" : true
      }, {
        "left" : "SMART_LOCATOR",
        "right" : true
      }, {
        "left" : "BASIC",
        "right" : true
      }, {
        "left" : "CSS",
        "right" : true
      }, {
        "left" : "IMAGE",
        "right" : true
      } ],
      "proxy" : "{\"proxyOption\":\"NO_PROXY\",\"proxyServerType\":\"HTTP\",\"username\":\"\",\"password\":\"\",\"proxyServerAddress\":\"\",\"proxyServerPort\":0,\"exceptionList\":\"\",\"applyToDesiredCapabilities\":true}",
      "defaultFailureHandling" : "STOP_ON_FAILURE",
      "terminateDriverAfterTestCase" : false,
      "defaultPageLoadTimeout" : 30.0,
      "report" : {
        "videoRecorderOption" : {
          "enable" : false,
          "useBrowserRecorder" : true,
          "videoFormat" : "AVI",
          "videoQuality" : "LOW",
          "recordAllTestCases" : false,
          "allowedRecordIfFailed" : true,
          "allowedRecordIfPassed" : false
        },
        "takeScreenshotSettings" : {
          "enable" : true
        },
        "screenCaptureOption" : true,
        "reportFolder" : "/var/folders/7m/lm7d6nx51kj0kbtnsskz6r3m0000gn/T/Katalon/Test Cases/prettyPrintExecutionSetting/20250123_205054"
      },
      "enablePageLoadTimeout" : false,
      "terminateDriverAfterTestSuite" : true,
      "useActionDelayInSecond" : "SECONDS",
      "testDataInfo" : { },
      "selfHealingEnabled" : false
    },
    "drivers" : {
      "system" : {
        "WebUI" : {
          "chromeDriverPath" : "/Applications/Katalon Studio.app/Contents/Eclipse/configuration/resources/drivers/chromedriver_mac/chromedriver",
          "browserType" : "CHROME_DRIVER"
        }
      },
      "preferences" : {
        "WebUI" : { }
      }
    },
    "globalSmartWaitEnabled" : true,
    "smartLocatorEnabled" : false,
    "smartLocatorSettingDefaultEnabled" : true,
    "logTestSteps" : true,
    "hideHostname" : false,
    "current_testcase" : "Test Cases/prettyPrintExecutionSetting"
  },
  "sessionServer.port" : 53788.0,
  "maxFailedTests" : -1.0
}
1月 23, 2025 8:51:00 午後 com.kms.katalon.core.logging.KeywordLogger endTest
情報: END Test Cases/prettyPrintExecutionSetting
----

The call to `RunConfigurationModifier.implementPrettyPrintExecutionSetting()` dynamically injects a static method `prettyPrintExecutionSetting` in the RunConfiguration class.

The call to `RunConfiguration.prettyPrintExecutionSetting()` prints the content of the `localExecutionSettingMapStorage` variable inside the `RunConfiguration` object, which contains the values set in the `Project Settings > Execution` GUI window of Katalon Studio.

=== Updating the `Project Settings > Execution > Default wait for element timeout (in secods)` on the fly

[source,groovy]
----
include::../Scripts/updateDefaultTimeOut/Script1737627443432.groovy[]
----

When I ran this I got the following output in the console:

[source,text]
----
1月 23, 2025 8:56:34 午後 com.kms.katalon.core.logging.KeywordLogger startTest
情報: --------------------
1月 23, 2025 8:56:34 午後 com.kms.katalon.core.logging.KeywordLogger startTest
情報: START Test Cases/updateDefaultTimeOut
Before modifying: RunConfiguration.getTimeOut()=30
After modifying:  RunConfiguration.getTimeOut()=8
1月 23, 2025 8:56:35 午後 com.kms.katalon.core.logging.KeywordLogger endTest
情報: END Test Cases/updateDefaultTimeOut
----

=== How is it implemented?

Please read the source of `com.kazurayam.ks.RunConfigurationModifier` classs. Here I would quote it:

[source,groovy]
----
include::../Keywords/com/kazurayam/ks/RunConfigurationModifier.groovy[]
----

In the `implementPrettyPrintExecutionSetting()` method, I used the https://www.groovy-lang.org/metaprogramming.html#metaprogramming_emc[Groovy's Meta-programming technique]. With this technique, the method dynamically injects the `prettyPrintExecutionSetting` method, which converts the `localExecutionSettingMap` variable of Groovy `Map` type into a pretty-formatted JSON String, and println it into the console.

The JSON tells you the internal data struction in the RunConfiguration object.

You should find the `setExecutionSetting(Map)` method is implemented in the `com.kms.katalon.core.configuration.RunConfiguration` class. Using this method, it is possible to update the content of the exectuion setting contained in the `RunConfiguration` object. The `updateTimeOut` method of the `RunConfigurationModifier` is a mere example how to make use of this capability. If you would like, you should be able to update many more items in the `Project Setting > Execution`. Please try it yourself.

